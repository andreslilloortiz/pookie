FROM win-macosx-pookie-lvl2-osxcross:latest

ARG PYTHON_URL
ARG PYTHON_VERSION

# Download and install Python for cross-compilation
RUN wget https://www.python.org/ftp/python/${PYTHON_VERSION}/Python-${PYTHON_VERSION}.tar.xz && \
    tar -xJf Python-${PYTHON_VERSION}.tar.xz && \
    cd Python-${PYTHON_VERSION} && \
    ./configure && \
    make -j$(nproc) && \
    make install && \
    cd .. && \
    rm -rf Python-${PYTHON_VERSION}*

# Download and extract Python framework for macOS
RUN wget ${PYTHON_URL} &&\
    7z x python-${PYTHON_VERSION}-macos11.pkg -opython-${PYTHON_VERSION}-macos11 &&\
    cd python-${PYTHON_VERSION}-macos11/Python_Framework.pkg/ &&\
    mv Payload Payload.gz &&\
    gunzip Payload.gz &&\
    cpio -i < Payload

RUN rm python-${PYTHON_VERSION}-macos11.pkg